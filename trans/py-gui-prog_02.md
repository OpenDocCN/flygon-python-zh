# 使用 Tkinter 设计 GUI 应用程序

软件应用程序的开发分为三个重复阶段：理解问题、设计解决方案和实施解决方案。这些阶段在应用程序的整个生命周期中重复，不断完善和改进，直到它变得最佳或过时。

在本章中，我们将学习以下主题：

+   介绍和分析工作场所中需要软件解决方案的场景

+   记录解决方案的要求

+   为实施解决方案的软件设计一个设计

# ABQ AgriLabs 的问题

恭喜！你的 Python 技能让你在 ABQ AgriLabs 找到了一份出色的数据分析师工作。到目前为止，你的工作相当简单：整理并对每天从实验室数据录入人员那里收到的 CSV 文件进行简单的数据分析。

然而，有一个问题。你沮丧地注意到实验室的 CSV 文件质量非常不一致。数据缺失，错别字丛生，而且文件经常需要重新输入，耗费大量时间。实验室主任也注意到了这一点，并且知道你是一位技艺高超的 Python 程序员，她认为你可能能够提供帮助。

你被委托编写一个解决方案，允许数据录入人员将实验室数据输入到 CSV 文件中，减少错误。你的应用程序需要简单，并且尽量减少错误的可能性。

# 评估问题

电子表格通常是需要跟踪数据的计算机用户的第一站。它们的表格布局和计算功能似乎使它们成为完成任务的理想选择。然而，随着数据集的增长和多个用户的添加，电子表格的缺点变得明显：它们不能强制数据完整性，它们的表格布局在处理稀疏或模糊数据的长行时可能会造成视觉混乱，如果用户不小心的话，他们可以轻松地删除或覆盖数据。

为了改善这种情况，你建议实现一个简单的 GUI 数据输入表单，将数据以我们需要的格式追加到 CSV 文件中。表单可以在多种方式上帮助改善数据完整性：

+   只允许输入正确类型的数据（例如，只允许在数字字段中输入数字）

+   限制选择只能是有效的选项

+   自动填充当前日期、时间等信息

+   验证输入的数据是否在预期范围内或与预期模式匹配

+   确保所有数据都已填写

通过实施这样的表单，我们可以大大减少数据录入人员输入的错误数量。

# 收集有关问题的信息

要构建数据输入表单应用程序，你需要收集关于它需要完成的任务的详细信息。幸运的是，你已经知道了等式的输出部分：你需要一个包含每个实验室地块上植物生长和每个地块的环境条件数据的 CSV 文件。你每天都在使用这些文件，所以你对字段布局非常熟悉。

然而，你并不知道关于数据或输入过程的一切；你需要与其他相关人员交谈，以获取更多信息。

首先，你需要更详细地了解正在记录的数据。这并不总是那么容易。软件在处理数据时需要绝对的、黑白分明的规则；而人们往往倾向于以一般性的方式思考他们的数据，并且通常在没有一些提示的情况下不考虑限制或边缘情况的确切细节。

作为程序员，你的工作是提出问题，以获取你所需要的信息。

你决定应该从实验室技术人员开始，了解他们正在收集的数据。你提出了以下问题：

+   每个字段的可接受值是什么？是否有任何字段受限于一组值？

+   每个数字字段代表什么单位？

+   数字字段是否真的只是数字字段？它们是否会需要字母或符号？

+   每个数字字段的可接受范围是多少？

+   你是如何记录数据的，需要多长时间？

数据不是唯一的考虑因素。如果我们正在制作一个帮助减少用户错误的程序，我们还必须了解这些用户以及他们的工作方式。在这个应用程序的情况下，我们的用户将是数据录入人员。我们需要向他们询问关于他们的需求和工作流程的问题，以了解如何为他们创建一个良好运行的应用程序。

我们列出了以下问题清单：

+   你输入的数据是以什么格式？

+   数据是何时接收并且多快被输入？最晚可能是什么时候输入？

+   是否有字段可以自动填充？用户是否能够覆盖自动值？

+   用户的整体技术能力如何？

+   你喜欢当前解决方案的什么？你不喜欢什么？

+   用户是否有视觉或手动障碍需要考虑？

最后，我们需要了解与操作我们的应用程序相关的技术——用于完成任务的计算机、网络、服务器和平台。

你决定添加以下问题，当你与数据录入人员会面时，你将自己评估：

+   数据录入使用什么样的计算机？

+   它运行在什么平台上？

+   它有多快或多强大？

+   这些系统上是否有 Python 可用？

+   有哪些 Python 库可用？

# 你发现了什么

你首先写下你知道的关于 ABQ 的基本信息：

+   你的 ABQ 设施有五个温室，每个温室都有不同的气候，标记为 A、B、C、D 和 E

+   每个温室有 20 个地块（标记为 1 到 20）

+   目前有四个种子样本，每个都用一个六位字符标签编码

+   每个样本的每个地块都种植了 20 颗种子，以及自己的环境传感器单元

# 正在收集的数据的信息

你与实验室技术人员的交谈揭示了很多关于数据的信息。每天四次，分别在 8:00、12:00、16:00 和 20:00，每个技术人员检查一两个实验室的地块。他们使用纸质表格记录每个地块的值，将所有值记录到小数点后两位。这通常需要每个实验室 30 到 40 分钟，整个过程通常需要 90 分钟。

每个地块都有一个环境传感器，用于检测地块的光线、温度和湿度。不幸的是，这些设备容易出现故障，单位上的`设备` `故障`指示灯会亮起。技术人员记录这个灯是否亮起，因为它会使环境数据无效。

最后，技术人员告诉你有关单位和字段的可接受范围，你记录在以下图表中：

| **字段** | **数据类型** | **备注** |
| --- | --- | --- |
| `日期` | `日期` | 数据收集日期。几乎总是当前日期 |
| `时间` | `时间` | 测量期间的开始时间。8:00、12:00、16:00 或 20:00 之一 |
| `实验室` | `字符` | 实验室 ID，将是 A 到 E |
| `技术人员` | `文本` | 记录数据的技术人员的姓名 |
| `地块` | `整数` | 地块 ID，从 1 到 20 |
| `种子样本` | `文本` | 种子样本的 ID 字符串。始终是包含数字 0 到 9 和大写字母 A 到 Z 的六位字符代码 |
| `故障` | `布尔` | 如果环境设备注册了故障，则为真，否则为假 |
| `湿度` | `小数` | 每立方米的绝对湿度，大约在 0.5 到 52.0 之间 |
| `光线` | `小数` | 地块中心的阳光量，单位为千勒克斯，介于 0 和 100 之间 |
| `温度` | `小数` | 摄氏度，不应低于 4 或高于 40 |
| `开花` | `整数` | 地块上的花朵数量必须是 0 或更多，但不太可能接近 1000 |
| `水果` | `整数` | 地块上的水果数量必须是 0 或更多，但不太可能接近 1000 |
| `植物` | `整数` | 生长植物的数量，介于 0 和 20 之间。 |
| `最大高度` | `小数` | 植物的最大高度（厘米）。至少为 0，不太可能接近 1,000。 |
| `中位高度` | `小数` | 样地内植物的中位高度（厘米）。至少为 0，不太可能接近 1,000 |
| `最小高度` | `小数` | 植物的最小高度（厘米）。至少为 0，不太可能接近 1,000 |
| `备注` | `长文本` | 关于植物、数据、仪器等的其他观察。 |

# 应用程序用户的信息

您与数据录入人员的会话为您提供了关于他们的工作流程、要求和技术的有用信息。

实验室技术人员在完成后交接他们的纸质表格。数据通常会立即输入，并且通常在交接当天就会完成。

技术人员目前正在使用 Debian Linux 工作站上的 LibreOffice 进行数据输入。使用复制和粘贴，他们可以批量填写重复数据，如日期、时间和技术人员。LibreOffice 的自动完成功能在文本字段中通常很有帮助，但有时会在数字字段中导致意外的数据错误。

正在使用的工作站已经使用了几年，但性能仍然良好。您有机会查看它，并发现 Python 和 Tkinter 已经安装。

总共有四名数据录入员，但一次只有一名工作；在采访这些员工时，您了解到其中一名员工有红绿色盲，另一名员工由于 RSI 问题难以使用鼠标。所有员工都具有合理的计算机素养。

# 记录规格要求

现在，您已经收集了关于应用程序的数据，是时候撰写一份**规格说明**了。软件规格说明可以从非常正式的、包括时间估计和截止日期的合同文件，到程序员打算构建的简单描述集合。规格说明的目的是为项目中的所有参与者提供开发人员将创建的参考点。它详细说明了要解决的问题、所需的功能以及程序应该做什么和不应该做什么的范围。

您的情景相当非正式，您的应用程序很简单，因此在这种情况下您不需要详细的正式规格说明。然而，对您所知道的基本描述将确保您、您的老板和用户都在同一页面上。

# 简要规格说明的内容

我们将从以下项目的概述开始撰写我们需要的内容：

+   **描述**：这是描述应用程序的主要目的、功能和目标的一两句话。将其视为程序的使命宣言。

+   **所需功能**：这一部分是程序需要具备的最基本功能的具体列表。它可以包括硬性要求，如详细的输出和输入格式，以及软性要求——无法量化实现的目标，但程序应该努力实现（例如，“尽量减少用户错误”）。

+   **不需要的功能**：这一部分是程序不需要执行的功能的列表；它存在的目的是澄清软件的范围，并确保没有人对应用程序期望不合理的事情。

+   **限制**：这是程序必须在其中运行的技术和人为约束的列表。

+   **数据字典**：这是应用程序将处理的数据字段及其参数的详细列表。这些内容可能会变得非常冗长，但在应用程序扩展和数据在其他上下文中被利用时，它们是关键的参考。

# 编写 ABQ 数据录入程序规格说明

您可以在您喜欢的文字处理器中编写规格说明，但理想情况下，规格说明应该是代码的一部分；它需要与代码一起保存，并与应用程序的任何更改同步。因此，我们将使用**reStructuredText**标记语言在我们的文本编辑器中编写它。

对于 Python 文档，reStructuredText 或 reST 是官方的标记语言。Python 社区鼓励使用 reST 来记录 Python 项目，并且 Python 社区中使用的许多打包和发布工具都期望 reST 格式。我们将在第五章“规划我们应用程序的扩展”中更深入地介绍 reST，但您可以在[`docutils.sourceforge.net/rst.html`](http://docutils.sourceforge.net/rst.html)找到官方文档。

让我们开始逐个部分编写我们的规范：

1.  以应用程序的名称和简短描述开始规范。这应该包含程序目的的摘要，如下： 

```py
======================================
 ABQ Data Entry Program specification
======================================

Description
-----------
The program is being created to minimize data entry errors for laboratory measurements.
```

1.  现在，让我们列出要求。请记住，硬性要求是客观可实现的目标——输入和输出要求、必须进行的计算、必须存在的功能，而我们的软性要求是主观或尽力而为的目标。浏览上一节的发现，并考虑哪些需求属于哪种需求。

您应该得出类似以下的结论：

```py

Functionality Required
----------------------

The program must:

* allow all relevant, valid data to be entered, as per the field chart
* append entered data to a CSV file
  - The CSV file must have a filename
    of abq_data_record_CURRENTDATE.csv, where 
    CURRENTDATE is the date of the checks in 
    ISO format (Year-month-day)
  - The CSV file must have all the fields as per the chart
* enforce correct datatypes per field

The program should try, whenever possible, to:

* enforce reasonable limits on data entered
* Auto-fill data
* Suggest likely correct values
* Provide a smooth and efficient workflow
```

1.  接下来，我们将通过`Functionality Not Required`部分限制程序的范围。请记住，目前这只是一个输入表单；编辑或删除将在电子表格应用程序中处理。我们将明确如下：

```py
Functionality Not Required
--------------------------

The program does not need to:

* Allow editing of data. This can be done in LibreOffice if necessary.
* Allow deletion of data.
```

1.  对于`Limitations`部分，请记住我们有一些具有身体限制的用户，还有硬件和操作系统的限制。添加如下：

```py
Limitations
-----------

The program must:

* Be efficiently operable by keyboard-only users.
* Be accessible to color blind users.
* Run on Debian Linux.
* Run acceptably on a low-end PC.
```

1.  最后，数据字典，这本质上是我们之前制作的表格，但我们将分解范围、数据类型和单位以供快速参考，如下：

```py
+------------+----------+------+--------------+---------------------+
|Field       | Datatype | Units| Range        |Descripton           |
+============+==========+======+==============+=====================+
|Date        |Date      |      |              |Date of record       |
+------------+----------+------+--------------+---------------------+
|Time        |Time      |      |8, 12, 16, 20 |Time period          |
+------------+----------+------+--------------+---------------------+
|Lab         |String    |      | A - E        |Lab ID               |
+------------+----------+------+--------------+---------------------+
|Technician  |String    |      |              |Technician name      |
+------------+----------+------+--------------+---------------------+
|Plot        |Int       |      | 1 - 20       |Plot ID              |
+------------+----------+------+--------------+---------------------+
|Seed        |String    |      |              |Seed sample ID       |
|sample      |          |      |              |                     |
+------------+----------+------+--------------+---------------------+
|Fault       |Bool      |      |              |Fault on sensor      |
+------------+----------+------+--------------+---------------------+
|Light       |Decimal   |klx   | 0 - 100      |Light at plot        |
+------------+----------+------+--------------+---------------------+
|Humidity    |Decimal   |g/m³  | 0.5 - 52.0   |Abs humidity at plot |
+------------+----------+------+--------------+---------------------+
|Temperature |Decimal   |°C    | 4 - 40       |Temperature at plot  |
+------------+----------+------+--------------+---------------------+
|Blossoms    |Int       |      | 0 - 1000     |# blossoms in plot   |
+------------+----------+------+--------------+---------------------+
|Fruit       |Int       |      | 0 - 1000     |# fruits in plot     |
+------------+----------+------+--------------+---------------------+
|Plants      |Int       |      | 0 - 20       |# plants in plot     |
+------------+----------+------+--------------+---------------------+
|Max height  |Decimal   |cm    | 0 - 1000     |Ht of tallest plant  |
+------------+----------+------+--------------+---------------------+
|Min height  |Decimal   |cm    | 0 - 1000     |Ht of shortest plant |
+------------+----------+------+--------------+---------------------+
|Median      |Decimal   |cm    | 0 - 1000     |Median ht of plants  |
|height      |          |      |              |                     |
+------------+----------+------+--------------+---------------------+
|Notes       |String    |      |              |Miscellaneous notes  |
+------------+----------+------+--------------+---------------------+
```

这就是我们目前的规范！随着我们发现新的需求，规范很可能会增长、改变或发展复杂性。

# 设计应用程序

有了我们手头的规范和清晰的要求，现在是时候开始设计我们的解决方案了。我们将从表单 GUI 组件本身开始。

| `ttk.Combobox` | 带有可选文本输入的下拉列表 | 在几个值之间进行选择以及文本输入 |

1.  确定每个数据字段的适当`input`小部件

1.  将相关项目分组以创建组织感

1.  在表单上将我们的小部件分组布局

# 探索 Tkinter 输入小部件

与所有工具包一样，Tkinter 为不同类型的数据提供了各种`input`小部件。然而，`ttk`提供了额外的小部件类型，并增强了 Tkinter 的一些（但不是全部！）原生小部件。以下表格提供了关于哪些小部件最适合不同类型的数据输入的建议：

| **小部件** | **描述** | **用于** |
| --- | --- | --- |
| `ttk.Entry` | 基本文本输入 | 单行字符串 |
| `ttk.Spinbox` | 具有增量/减量箭头的文本输入 | 数字 |
| `Tkinter.Listbox` | 带有选择列表的框 | 在几个值之间进行选择 |
| `Tkinter.OptionMenu` | 带有选择列表的下拉列表 | 在几个值之间进行选择 |
| 我们将按照以下三个步骤为我们的表单创建一个基本设计： |
| `ttk.Checkbutton` | 带标签的复选框 | 布尔值 |
| `ttk.Radiobutton` | 类似复选框，但只能选择一组中的一个 | 在一组小部件中选择 |
| `Tkiner.Text` | 多行文本输入框 | 长、多行字符串 |
| `Tkinter.Scale` | 鼠标操作滑块 | 有界数值数据 |

让我们考虑哪些小部件适合需要输入的数据：

+   有几个`Decimal`字段，其中许多具有明确的边界范围，包括`Min height`，`Max height`，`Median height`，`Humidity`，`Temperature`和`Light`。您可以使用`Scale`小部件进行操作，但对于精确的数据输入来说并不是很合适，因为它需要仔细的定位才能获得精确的值。它也是鼠标操作的，这违反了您的规范要求。相反，对于这些字段，请使用`Spinbox`小部件。

+   还有一些`Int`字段，例如`植物`，`花朵`和`水果`。同样，`Spinbox`小部件是正确的选择。

+   有一些字段具有一组可能值—`时间`和`实验室`。`Radiobutton`或`Listbox`小部件可能适用于这些字段，但两者都占用大量空间，并且不太友好，因为它们需要使用箭头键进行选择。还有`OptionMenu`，但它也只能使用鼠标或箭头键。对于这些字段，应使用`Combobox`小部件。

+   图表是一个棘手的情况。乍一看，它看起来像一个`Int`字段，但仔细想想。图表也可以用字母、符号或名称来标识。数字只是一组易于分配任意标识符的值。`图表 ID`，就像`实验室 ID`一样，是一组受限制的值；因此，在这里使用`Combobox`小部件更合理。

+   `注释`字段是多行文本，因此在这里使用`Text`小部件是合适的。

+   有一个`Boolean`字段，`故障`。它可以使用`Radiobutton`或`Combobox`来处理，但`Checkbutton`是最佳选择—它紧凑且相对键盘友好。

+   其余行都是简单的单行字符字段。我们将使用`Entry`来处理这些字段。

+   您可能会对`日期`字段感到困惑。Tkinter 没有专门用于日期的小部件；因此，我们暂时将在这里使用通用的`Entry`小部件。

我们的最终分析将如下所示：

| **字段** | **小部件类型** |
| --- | --- |
| `花朵` | `ttk.Spinbox` |
| `日期` | `ttk.Entry` |
| `故障` | `ttk.Checkbutton` |
| `水果` | `ttk.Spinbox` |
| `湿度` | `ttk.Spinbox` |
| `实验室` | `ttk.Combobox` |
| `光线` | `ttk.Spinbox` |
| `最大高度` | `ttk.Spinbox` |
| `中位高度` | `ttk.Spinbox` |
| `最小高度` | `ttk.Spinbox` |
| `注释` | `Tkinter.Text` |
| `植物` | `ttk.Spinbox` |
| `图表` | `ttk.Combobox` |
| `种子样本` | `ttk.Entry` |
| `技术人员` | `ttk.Entry` |
| `温度` | `ttk.Spinbox` |
| `时间` | `ttk.Combobox` |

# 对我们的字段进行分组

人们在没有特定顺序的大量输入面前往往会感到困惑。通过将输入表单分成相关字段的集合，您可以为用户做出很大的帮助。当然，这假设您的数据具有相关字段的集合，不是吗？

在查看了您的字段后，您确定了以下相关组：

+   `日期`，`实验室`，`图表`，`种子样本`，`技术人员`和`时间`字段是关于记录本身的标识数据或元数据。您可以将它们组合在一个标题下，如`记录信息`。

+   `花朵`，`水果`，三个`高度`字段和`植物`字段都是与`图表`字段中的植物有关的测量值。您可以将它们组合在一起，称为`植物数据`。

+   `湿度`，`光线`，`温度`和`设备故障`字段都是来自环境传感器的信息。您可以将它们组合为`环境数据`。

+   `注释`字段可能与任何事物有关，因此它属于自己的类别。

在 Tkinter 中对前面的字段进行分组，我们可以在每组字段之间插入标签，但值得探索将小部件组合在一起的各种选项：

| **小部件** | **描述** |
| --- | --- |
| `ttk.LabelFrame` | 带有标签文本和可选边框的框架 |
| `ttk.NoteBook` | 允许多个页面的选项卡小部件 |
| `Tkinter.PanedWindow` | 允许在水平或垂直排列中有多个可调整大小的框架 |

我们不希望我们的表单跨多个页面，用户也不需要调整各个部分的大小，但`LabelFrame`小部件非常适合我们的需求。

# 布置表单

到目前为止，我们知道我们有 17 个输入，分组如下：

+   `记录信息`下的六个字段

+   `环境数据`下的四个字段

+   `植物数据`下的六个字段

+   一个大的`注释`字段

我们希望使用`LabelFrame`来对前面的输入进行分组。

请注意，前三个部分中的两个有三个小部件。这表明我们可以将它们排列在一个三个项目横向的网格中。我们应该如何对每个组内的字段进行排序？

字段的排序似乎是一个微不足道的事项，但对于用户来说，它可能在可用性上产生重大影响。必须在表单中随意跳转以匹配其工作流程的用户更有可能出错。

正如您所了解的，数据是由实验室技术人员填写的纸质表格输入的。您已经获得了表格的副本，如下截图所示：

![](img/5c9481da-4be5-4b0d-ae11-c269df173e16.png)

看起来项目大多按照我们的记录分组的方式进行分组，因此我们将使用此表单上的顺序来对我们的字段进行排序。这样，数据输入员就可以直接通过表单，而不必在屏幕上来回跳动。

在设计新应用程序以替换现有工作流程的某个部分时，了解和尊重该工作流程是很重要的。虽然我们必须调整工作流程以实际改进它，但我们不希望使某人的工作变得更加困难，只是为了使我们正在处理的部分更简单。

我们设计中的最后一个考虑是标签与字段的相对位置。在 UI 设计社区中，关于标签的最佳放置位置存在很多争论，但共识是以下两种选项中的一种最佳：

+   字段上方的标签

+   字段左侧的标签

您可以尝试绘制两者，看看哪个更适合您，但对于此应用程序，字段上方的标签可能会更好，原因如下：

+   由于字段和标签都是矩形形状，我们的表单将通过将它们堆叠在一起更加紧凑。

+   这样做起来要容易得多，因为我们不必找到适用于所有标签的标签宽度，而不会使它们与字段之间的距离太远

唯一的例外是复选框字段；复选框通常标记在小部件的右侧。

花点时间用纸和铅笔或绘图程序制作一个表单的草图。您的表单应如下所示：

![](img/b492e61c-f61f-4088-882b-c2e5aec87a18.png)

# 布局应用程序

设计好您的表单后，现在是考虑应用程序 GUI 的其余部分的时候了：

+   您需要一个保存按钮来触发输入数据的存储

+   有时，我们可能需要向用户提供状态信息；应用程序通常有一个状态栏，用于显示这些类型的消息

+   最后，最好有一个标题来指示表单是什么

将以下内容添加到我们的草图中，我们得到了以下截图：

![](img/35e3cd90-956d-490f-9e44-a3ca0524ceb4.png)

看起来不错！这绝对是一个我们可以在 Tkinter 中实现的表单。您的最后一步是向用户和主管展示这些设计，以获取任何反馈或批准。

尽量让利益相关者参与到应用程序设计过程中。这样可以减少您以后不得不回头重新设计应用程序的可能性。

# 总结

在这一章中，您已经完成了应用程序开发的前两个阶段：了解问题和设计解决方案。您学会了如何通过采访用户和检查数据和要求来开发应用程序规范，为用户创建最佳的表单布局，并了解了 Tkinter 中可用的小部件，用于处理不同类型的输入数据。最重要的是，您学会了开发应用程序不是从编码开始，而是从研究和规划开始。

在下一章中，您将使用 Tkinter 和 Python 创建您设计的基本实现。我们将熟悉创建表单所需的 Tkinter 小部件，构建表单，并将表单放置在应用程序中。我们还将学习如何使我们的表单触发回调操作，并发现如何构建我们的代码以确保效率和一致性。
